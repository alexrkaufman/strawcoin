{% extends "base.jinja2" %}

{% block content %}
<div class="welcome-section">
    <h1 class="welcome-title">ğŸ“Š Real-Time Market Leaders</h1>
    <p class="welcome-subtitle">Watch the comedy coin race unfold in real-time!</p>
    {% if current_username %}
    <div class="user-balance-card" data-username="{{ current_username }}" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">
        <h3>ğŸ Your Position: <span id="userPosition">Calculating...</span></h3>
        <p class="balance-amount">{{ "{:,}".format(current_user_balance) }} Straw Coins</p>
    </div>

    <!-- Navigation Links -->
    <div class="nav-links">
        <a href="/" class="leaderboard-link" style="background: linear-gradient(45deg, #2ecc71, #27ae60);">
            ğŸ  Back to Home
        </a>
    </div>
    {% endif %}
</div>

<!-- Chart Controls -->
<div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
    <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;">
        <div>
            <label class="font-bold" style="margin-right: 10px;">Time Range:</label>
            <select id="timeRangeSelect" class="form-input" style="padding: 8px; border-radius: 5px; width: auto;">
                <option value="0.5" selected>Last 30 minutes</option>
                <option value="1">Last hour</option>
                <option value="1.5">Last 90 minutes</option>
                <option value="2">Last 2 hours</option>
                <option value="3">Last 3 hours</option>
            </select>
        </div>

        <button id="refreshBtn" class="send-btn" style="background: linear-gradient(45deg, #3498db, #2980b9); padding: 10px 20px;">
            ğŸ”„ Refresh Data
        </button>

        <div id="lastUpdate" class="opacity-80" style="font-size: 0.9rem;">
            Last updated: <span id="updateTime">--</span>
        </div>
    </div>
</div>

<!-- Chart Container -->
<div class="chart-container" style="height: 500px;">
    <canvas id="leaderboardChart"></canvas>
    <div id="chartStatus" class="text-center opacity-80 mt-15" style="font-style: italic; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);">
        Loading chart data...
    </div>
</div>

<!-- Current Leaderboard -->
<div class="leaderboard-section">
    <h2 class="leaderboard-title">ğŸ† Current Rankings</h2>
    <div id="currentLeaderboard" class="leaderboard-grid">
        <!-- Will be populated by JavaScript -->
    </div>
</div>

<!-- Racing Stats -->
<div class="market-stats-grid">
    <div class="stat-card">
        <h3>ğŸš€ Biggest Gainer</h3>
        <div id="biggestGainer">
            <p class="stat-value">--</p>
            <p style="color: #2ecc71;">+-- coins</p>
        </div>
    </div>
    <div class="stat-card">
        <h3>ğŸ“‰ Biggest Loser</h3>
        <div id="biggestLoser">
            <p class="stat-value">--</p>
            <p style="color: #e74c3c;">--- coins</p>
        </div>
    </div>
    <div class="stat-card">
        <h3>âš¡ Most Active</h3>
        <div id="mostActive">
            <p class="stat-value">--</p>
            <p>-- transactions</p>
        </div>
    </div>
    <div class="stat-card">
        <h3>ğŸ“Š Data Points</h3>
        <div id="dataStats">
            <p class="stat-value" id="totalDataPoints">--</p>
            <p>Balance updates tracked</p>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.1/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script>
    // Pass current username to JavaScript
    window.currentUsername = '{{ current_username }}';
</script>
<script src="{{ url_for('static', filename='js/leaderboard.js') }}"></script>
{% endblock %}
